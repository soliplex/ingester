import{a as z,P as Vt}from"../chunks/Bf58JmFK.js";import{e as Lt}from"../chunks/CBbuBPfZ.js";import{f as _,e as Xt,a as f,s as m}from"../chunks/B3CJz9bp.js";import{p as Bt,c as t,t as C,g as d,a as Mt,s as e,r as a,n as Ft,b as P,d as c,f as Yt,u as Ot}from"../chunks/BrMMe1xa.js";import{i as O}from"../chunks/CWeRAD6a.js";import{b as ut}from"../chunks/DghzB7bT.js";import{W as Zt}from"../chunks/DUw74D4v.js";import{S as U}from"../chunks/gXm1V3gg.js";import{e as Gt,i as Tt}from"../chunks/jBV541Un.js";import{r as $t}from"../chunks/WXE6NR2k.js";import{b as ta,L as aa}from"../chunks/lmSxvigd.js";import{T as At}from"../chunks/bNY3RGCW.js";import{R as v}from"../chunks/BOsosYgm.js";import{c as ea}from"../chunks/Or1p4CJ_.js";import{i as ra}from"../chunks/BibsGK1G.js";const oa=async({params:G})=>{try{const r=parseInt(G.id);if(isNaN(r))throw Lt(400,"Invalid batch ID");const[n,x,b,g]=await Promise.all([z.getBatchStatus(r),z.getWorkflowRuns(r),z.getWorkflowDefinitions(),z.getParamSets()]);return{batchId:r,batch:n.batch,documentCount:n.document_count,workflowCounts:n.workflow_count,workflows:x,parsed:n.parsed,remaining:n.remaining,workflowDefinitions:b,paramSets:g}}catch(r){throw console.error("Failed to load batch:",r),Lt(404,"Batch not found")}},Fa=Object.freeze(Object.defineProperty({__proto__:null,load:oa},Symbol.toStringTag,{value:"Module"}));var sa=_("<option> </option>"),da=_("<option> </option>"),ia=_('<div class="rounded-md bg-red-50 p-3" role="alert"><p class="text-sm text-red-800"> </p></div>'),la=_('<div class="rounded-md bg-green-50 p-3" role="alert"><p class="text-sm text-green-800"> </p></div>'),na=_("<!> <span>Starting...</span>",1),va=_("<span>Start Workflows</span>"),ua=_('<div class="rounded-lg border border-gray-200 bg-white p-6 shadow"><h3 class="text-lg font-semibold text-gray-900">Start Workflows</h3> <p class="mt-1 text-sm text-gray-600">Start workflow processing for all documents in this batch</p> <form class="mt-4 space-y-4"><div><label for="workflow" class="block text-sm font-medium text-gray-700">Workflow Definition</label> <select id="workflow" class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"><option>Default (from config)</option><!></select></div> <div><label for="param-set" class="block text-sm font-medium text-gray-700">Parameter Set</label> <select id="param-set" class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"><option>Default</option><!></select></div> <div><label for="priority" class="block text-sm font-medium text-gray-700">Priority</label> <input type="number" id="priority" min="0" max="100" class="mt-1 block w-full rounded-md border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"/> <p class="mt-1 text-xs text-gray-500">Higher values = higher priority (default: 0)</p></div> <!> <!> <div class="flex justify-end"><button type="submit" class="inline-flex items-center gap-2 rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-400 disabled:cursor-not-allowed"><!></button></div></form></div>');function ca(G,r){Bt(r,!0);let n=P(""),x=P("default"),b=P(0),g=P(!1),w=P(null),h=P(null);async function H(s){s.preventDefault(),c(g,!0),c(w,null),c(h,null);try{const o=await z.startWorkflows(r.batchId,d(n)||void 0,d(b),d(x)||void 0);c(h,`${o.message}: ${o.workflows} workflows started (Run Group: ${o.run_group})`),c(n,""),c(x,"default"),c(b,0),r.onSuccess&&setTimeout(r.onSuccess,1500)}catch(o){c(w,o instanceof Error?o.message:"Failed to start workflows",!0)}finally{c(g,!1)}}var k=ua(),S=e(t(k),4),D=t(S),y=e(t(D),2),W=t(y);W.value=W.__value="";var X=e(W);Gt(X,17,()=>r.workflowDefinitions,Tt,(s,o)=>{var i=sa(),p=t(i);a(i);var I={};C(()=>{m(p,`${d(o).name??""} (${d(o).id??""})`),I!==(I=d(o).id)&&(i.value=(i.__value=d(o).id)??"")}),f(s,i)}),a(y),a(D);var E=e(D,2),N=e(t(E),2),T=t(N);T.value=T.__value="";var A=e(T);Gt(A,17,()=>r.paramSets,Tt,(s,o)=>{var i=da(),p=t(i);a(i);var I={};C(()=>{m(p,`${d(o).name??""} (${d(o).id??""})`),I!==(I=d(o).id)&&(i.value=(i.__value=d(o).id)??"")}),f(s,i)}),a(N),a(E);var L=e(E,2),B=e(t(L),2);$t(B),Ft(2),a(L);var M=e(L,2);{var q=s=>{var o=ia(),i=t(o),p=t(i,!0);a(i),a(o),C(()=>m(p,d(w))),f(s,o)};O(M,s=>{d(w)&&s(q)})}var J=e(M,2);{var Y=s=>{var o=la(),i=t(o),p=t(i,!0);a(i),a(o),C(()=>m(p,d(h))),f(s,o)};O(J,s=>{d(h)&&s(Y)})}var K=e(J,2),F=t(K),Q=t(F);{var j=s=>{var o=na(),i=Yt(o);aa(i,{size:"sm"}),Ft(2),f(s,o)},V=s=>{var o=va();f(s,o)};O(Q,s=>{d(g)?s(j):s(V,!1)})}a(F),a(K),a(S),a(k),C(()=>{y.disabled=d(g),N.disabled=d(g),B.disabled=d(g),F.disabled=d(g)}),Xt("submit",S,H),ut(y,()=>d(n),s=>c(n,s)),ut(N,()=>d(x),s=>c(x,s)),ta(B,()=>d(b),s=>c(b,s)),f(G,k),Mt()}var ma=_('<a href="/batches" class="text-sm font-medium text-gray-600 hover:text-gray-900">← Back to batches</a>'),fa=_('<span class="inline-flex items-center rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800">✓ Complete</span>'),_a=_('<span class="inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-sm font-medium text-blue-800">⟳ In Progress</span>'),ga=_('<div><dt class="text-sm font-medium text-gray-500">Completed</dt> <dd class="mt-1 text-sm"><!></dd></div>'),pa=_('<div><dt class="text-sm font-medium text-gray-500">Duration</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div>'),xa=_('<div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8"><!> <div class="mt-6"><div class="overflow-hidden rounded-lg bg-white shadow"><div class="px-6 py-5"><div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"><div><dt class="text-sm font-medium text-gray-500">Batch ID</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Source</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Documents</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Status</dt> <dd class="mt-1"><!></dd></div></div> <div class="mt-6 border-t border-gray-200 pt-6"><div class="grid grid-cols-1 gap-6 sm:grid-cols-2"><div><dt class="text-sm font-medium text-gray-500">Started</dt> <dd class="mt-1 text-sm"><!></dd></div> <!> <!></div></div></div> <div class="border-t border-gray-200 bg-gray-50 px-6 py-4"><h3 class="text-sm font-medium text-gray-700">Workflow Status</h3> <div class="mt-3 flex flex-wrap gap-4"><div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div></div></div></div> <div class="mt-8"><!></div> <div class="mt-8"><div class="mb-4 flex items-center justify-between"><h2 class="text-lg font-semibold text-gray-900">Workflows</h2> <div class="flex items-center gap-2"><label for="status-select" class="text-sm text-gray-600">Filter:</label> <select id="status-select" class="rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"><option>All</option><option>Pending</option><option>Running</option><option>Completed</option><option>Error</option><option>Failed</option></select></div></div> <!></div></div></div>');function Oa(G,r){Bt(r,!0);let n=P("all");const x=Ot(()=>d(n)==="all"?r.data.workflows:r.data.workflows.filter(l=>l.status===d(n))),b=Ot(()=>r.data.batch.completed_date!==null);function g(){ra()}var w=xa(),h=t(w);Vt(h,{get title(){return`Batch: ${r.data.batch.name??""}`},actions:u=>{var R=ma();f(u,R)}});var H=e(h,2),k=t(H),S=t(k),D=t(S),y=t(D),W=e(t(y),2),X=t(W);a(W),a(y);var E=e(y,2),N=e(t(E),2),T=t(N,!0);a(N),a(E);var A=e(E,2),L=e(t(A),2),B=t(L,!0);a(L),a(A);var M=e(A,2),q=e(t(M),2),J=t(q);{var Y=l=>{var u=fa();f(l,u)},K=l=>{var u=_a();f(l,u)};O(J,l=>{d(b)?l(Y):l(K,!1)})}a(q),a(M),a(D);var F=e(D,2),Q=t(F),j=t(Q),V=e(t(j),2),s=t(V);At(s,{get date(){return r.data.batch.start_date}}),a(V),a(j);var o=e(j,2);{var i=l=>{var u=ga(),R=e(t(u),2),vt=t(R);At(vt,{get date(){return r.data.batch.completed_date}}),a(R),a(u),f(l,u)};O(o,l=>{r.data.batch.completed_date&&l(i)})}var p=e(o,2);{var I=l=>{var u=pa(),R=e(t(u),2),vt=t(R,!0);a(R),a(u),C(Qt=>m(vt,Qt),[()=>ea(r.data.batch.duration)]),f(l,u)};O(p,l=>{r.data.batch.duration!==null&&l(I)})}a(Q),a(F),a(S);var ct=e(S,2),mt=e(t(ct),2),Z=t(mt),ft=t(Z);U(ft,{get status(){return v.COMPLETED}});var _t=e(ft,2),jt=t(_t,!0);a(_t),a(Z);var $=e(Z,2),gt=t($);U(gt,{get status(){return v.RUNNING}});var pt=e(gt,2),Ut=t(pt,!0);a(pt),a($);var tt=e($,2),xt=t(tt);U(xt,{get status(){return v.PENDING}});var bt=e(xt,2),zt=t(bt,!0);a(bt),a(tt);var at=e(tt,2),wt=t(at);U(wt,{get status(){return v.ERROR}});var yt=e(wt,2),Ht=t(yt,!0);a(yt),a(at);var ht=e(at,2),kt=t(ht);U(kt,{get status(){return v.FAILED}});var St=e(kt,2),qt=t(St,!0);a(St),a(ht),a(mt),a(ct),a(k);var et=e(k,2),Jt=t(et);ca(Jt,{get batchId(){return r.data.batchId},get workflowDefinitions(){return r.data.workflowDefinitions},get paramSets(){return r.data.paramSets},onSuccess:g}),a(et);var Dt=e(et,2),rt=t(Dt),Et=e(t(rt),2),ot=e(t(Et),2),st=t(ot);st.value=st.__value="all";var dt=e(st),Nt={},it=e(dt),It={},lt=e(it),Rt={},nt=e(lt),Pt={},Ct=e(nt),Wt={};a(ot),a(Et),a(rt);var Kt=e(rt,2);Zt(Kt,{get workflows(){return d(x)}}),a(Dt),a(H),a(w),C(()=>{m(X,`#${r.data.batch.id??""}`),m(T,r.data.batch.source),m(B,r.data.documentCount),m(jt,r.data.workflowCounts.COMPLETED||0),m(Ut,r.data.workflowCounts.RUNNING||0),m(zt,r.data.workflowCounts.PENDING||0),m(Ht,r.data.workflowCounts.ERROR||0),m(qt,r.data.workflowCounts.FAILED||0),Nt!==(Nt=v.PENDING)&&(dt.value=(dt.__value=v.PENDING)??""),It!==(It=v.RUNNING)&&(it.value=(it.__value=v.RUNNING)??""),Rt!==(Rt=v.COMPLETED)&&(lt.value=(lt.__value=v.COMPLETED)??""),Pt!==(Pt=v.ERROR)&&(nt.value=(nt.__value=v.ERROR)??""),Wt!==(Wt=v.FAILED)&&(Ct.value=(Ct.__value=v.FAILED)??"")}),ut(ot,()=>d(n),l=>c(n,l)),f(G,w),Mt()}export{Oa as component,Fa as universal};
