import{a as V,P as Zt}from"../chunks/BOAlGdYI.js";import{e as Tt}from"../chunks/CBbuBPfZ.js";import{f as x,a as g,s as f,e as $t}from"../chunks/j3K8jUZk.js";import{l as ta,ax as aa,y as ea,ay as ra,T as sa,m as U,o as oa,c as t,s as r,r as a,t as S,p as Ut,g as l,a as Ht,n as At,b as L,d as h,f as da,u as Bt}from"../chunks/Dj7rAsuq.js";import{i as F}from"../chunks/C64RYOYL.js";import{b as _t}from"../chunks/mtVfkGY5.js";import{W as la}from"../chunks/68cU5iJb.js";import{S as H}from"../chunks/D8p6h-Bw.js";import{e as Mt,i as jt}from"../chunks/CoFdoVSq.js";import{r as ia}from"../chunks/nNctCYpw.js";import{s as na}from"../chunks/C2Md6CUa.js";import{p as va}from"../chunks/Bx2u9gNR.js";import{R as _}from"../chunks/DhxlaAyh.js";import{b as zt,a as ua}from"../chunks/CR8k5L1G.js";import{i as ca}from"../chunks/BgZ-RO6T.js";function ma(s,e,u=e){var b=new WeakSet;ta(s,"input",async c=>{var i=c?s.defaultValue:s.value;if(i=mt(s)?ft(i):i,u(i),U!==null&&b.add(U),await aa(),i!==(i=e())){var y=s.selectionStart,p=s.selectionEnd,k=s.value.length;if(s.value=i??"",p!==null){var m=s.value.length;y===p&&p===k&&m>k?(s.selectionStart=m,s.selectionEnd=m):(s.selectionStart=y,s.selectionEnd=Math.min(p,m))}}}),(sa&&s.defaultValue!==s.value||ea(e)==null&&s.value)&&(u(mt(s)?ft(s.value):s.value),U!==null&&b.add(U)),ra(()=>{var c=e();if(s===document.activeElement){var i=oa??U;if(b.has(i))return}mt(s)&&c===ft(s.value)||s.type==="date"&&!c&&!s.value||c!==s.value&&(s.value=c??"")})}function mt(s){var e=s.type;return e==="number"||e==="range"}function ft(s){return s===""?null:+s}var fa=x('<span class="text-sm text-gray-600"> </span>'),_a=x('<div class="flex items-center justify-center gap-2"><div role="status" aria-label="Loading"></div> <!></div>');function ga(s,e){let u=va(e,"size",3,"md");const b={sm:"h-4 w-4 border-2",md:"h-8 w-8 border-3",lg:"h-12 w-12 border-4"};var c=_a(),i=t(c),y=r(i,2);{var p=k=>{var m=fa(),D=t(m,!0);a(m),S(()=>f(D,e.text)),g(k,m)};F(y,k=>{e.text&&k(p)})}a(c),S(()=>na(i,1,`animate-spin rounded-full border-blue-600 border-t-transparent ${b[u()]??""}`)),g(s,c)}const xa=async({params:s})=>{try{const e=parseInt(s.id);if(isNaN(e))throw Tt(400,"Invalid batch ID");const[u,b,c,i]=await Promise.all([V.getBatchStatus(e),V.getWorkflowRuns(e),V.getWorkflowDefinitions(),V.getParamSets()]);return{batchId:e,batch:u.batch,documentCount:u.document_count,workflowCounts:u.workflow_count,workflows:b,parsed:u.parsed,remaining:u.remaining,workflowDefinitions:c,paramSets:i}}catch(e){throw console.error("Failed to load batch:",e),Tt(404,"Batch not found")}},Ja=Object.freeze(Object.defineProperty({__proto__:null,load:xa},Symbol.toStringTag,{value:"Module"}));var ba=x("<option> </option>"),pa=x("<option> </option>"),ya=x('<div class="rounded-md bg-red-50 p-3" role="alert"><p class="text-sm text-red-800"> </p></div>'),wa=x('<div class="rounded-md bg-green-50 p-3" role="alert"><p class="text-sm text-green-800"> </p></div>'),ha=x("<!> <span>Starting...</span>",1),ka=x("<span>Start Workflows</span>"),Sa=x('<div class="rounded-lg border border-gray-200 bg-white p-6 shadow"><h3 class="text-lg font-semibold text-gray-900">Start Workflows</h3> <p class="mt-1 text-sm text-gray-600">Start workflow processing for all documents in this batch</p> <form class="mt-4 space-y-4"><div><label for="workflow" class="block text-sm font-medium text-gray-700">Workflow Definition</label> <select id="workflow" class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"><option>Default (from config)</option><!></select></div> <div><label for="param-set" class="block text-sm font-medium text-gray-700">Parameter Set</label> <select id="param-set" class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"><option>Default</option><!></select></div> <div><label for="priority" class="block text-sm font-medium text-gray-700">Priority</label> <input type="number" id="priority" min="0" max="100" class="mt-1 block w-full rounded-md border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"/> <p class="mt-1 text-xs text-gray-500">Higher values = higher priority (default: 0)</p></div> <!> <!> <div class="flex justify-end"><button type="submit" class="inline-flex items-center gap-2 rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-400 disabled:cursor-not-allowed"><!></button></div></form></div>');function Da(s,e){Ut(e,!0);let u=L(""),b=L("default"),c=L(0),i=L(!1),y=L(null),p=L(null);async function k(d){d.preventDefault(),h(i,!0),h(y,null),h(p,null);try{const o=await V.startWorkflows(e.batchId,l(u)||void 0,l(c),l(b)||void 0);h(p,`${o.message}: ${o.workflows} workflows started (Run Group: ${o.run_group})`),h(u,""),h(b,"default"),h(c,0),e.onSuccess&&setTimeout(e.onSuccess,1500)}catch(o){h(y,o instanceof Error?o.message:"Failed to start workflows",!0)}finally{h(i,!1)}}var m=Sa(),D=r(t(m),4),I=t(D),N=r(t(I),2),O=t(N);O.value=O.__value="";var Y=r(O);Mt(Y,17,()=>e.workflowDefinitions,jt,(d,o)=>{var n=ba(),E=t(n);a(n);var P={};S(()=>{f(E,`${l(o).name??""} (${l(o).id??""})`),P!==(P=l(o).id)&&(n.value=(n.__value=l(o).id)??"")}),g(d,n)}),a(N),a(I);var R=r(I,2),C=r(t(R),2),A=t(C);A.value=A.__value="";var B=r(A);Mt(B,17,()=>e.paramSets,jt,(d,o)=>{var n=pa(),E=t(n);a(n);var P={};S(()=>{f(E,`${l(o).name??""} (${l(o).id??""})`),P!==(P=l(o).id)&&(n.value=(n.__value=l(o).id)??"")}),g(d,n)}),a(C),a(R);var G=r(R,2),M=r(t(G),2);ia(M),At(2),a(G);var j=r(G,2);{var q=d=>{var o=ya(),n=t(o),E=t(n,!0);a(n),a(o),S(()=>f(E,l(y))),g(d,o)};F(j,d=>{l(y)&&d(q)})}var J=r(j,2);{var Z=d=>{var o=wa(),n=t(o),E=t(n,!0);a(n),a(o),S(()=>f(E,l(p))),g(d,o)};F(J,d=>{l(p)&&d(Z)})}var K=r(J,2),T=t(K),Q=t(T);{var z=d=>{var o=ha(),n=da(o);ga(n,{size:"sm"}),At(2),g(d,o)},X=d=>{var o=ka();g(d,o)};F(Q,d=>{l(i)?d(z):d(X,!1)})}a(T),a(K),a(D),a(m),S(()=>{N.disabled=l(i),C.disabled=l(i),M.disabled=l(i),T.disabled=l(i)}),$t("submit",D,k),_t(N,()=>l(u),d=>h(u,d)),_t(C,()=>l(b),d=>h(b,d)),ma(M,()=>l(c),d=>h(c,d)),g(s,m),Ht()}var Ea=x('<a href="/batches" class="text-sm font-medium text-gray-600 hover:text-gray-900">← Back to batches</a>'),Na=x('<span class="inline-flex items-center rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800">✓ Complete</span>'),Ia=x('<span class="inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-sm font-medium text-blue-800">⟳ In Progress</span>'),Ra=x('<div><dt class="text-sm font-medium text-gray-500">Completed</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div>'),Ca=x('<div><dt class="text-sm font-medium text-gray-500">Duration</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div>'),Pa=x('<div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8"><!> <div class="mt-6"><div class="overflow-hidden rounded-lg bg-white shadow"><div class="px-6 py-5"><div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"><div><dt class="text-sm font-medium text-gray-500">Batch ID</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Source</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Documents</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Status</dt> <dd class="mt-1"><!></dd></div></div> <div class="mt-6 border-t border-gray-200 pt-6"><div class="grid grid-cols-1 gap-6 sm:grid-cols-2"><div><dt class="text-sm font-medium text-gray-500">Started</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <!> <!></div></div></div> <div class="border-t border-gray-200 bg-gray-50 px-6 py-4"><h3 class="text-sm font-medium text-gray-700">Workflow Status</h3> <div class="mt-3 flex flex-wrap gap-4"><div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div></div></div></div> <div class="mt-8"><!></div> <div class="mt-8"><div class="mb-4 flex items-center justify-between"><h2 class="text-lg font-semibold text-gray-900">Workflows</h2> <div class="flex items-center gap-2"><label for="status-select" class="text-sm text-gray-600">Filter:</label> <select id="status-select" class="rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"><option>All</option><option>Pending</option><option>Running</option><option>Completed</option><option>Error</option><option>Failed</option></select></div></div> <!></div></div></div>');function Ka(s,e){Ut(e,!0);let u=L("all");const b=Bt(()=>l(u)==="all"?e.data.workflows:e.data.workflows.filter(v=>v.status===l(u))),c=Bt(()=>e.data.batch.completed_date!==null);function i(){ca()}var y=Pa(),p=t(y);Zt(p,{get title(){return`Batch: ${e.data.batch.name??""}`},actions:w=>{var W=Ea();g(w,W)}});var k=r(p,2),m=t(k),D=t(m),I=t(D),N=t(I),O=r(t(N),2),Y=t(O);a(O),a(N);var R=r(N,2),C=r(t(R),2),A=t(C,!0);a(C),a(R);var B=r(R,2),G=r(t(B),2),M=t(G,!0);a(G),a(B);var j=r(B,2),q=r(t(j),2),J=t(q);{var Z=v=>{var w=Na();g(v,w)},K=v=>{var w=Ia();g(v,w)};F(J,v=>{l(c)?v(Z):v(K,!1)})}a(q),a(j),a(I);var T=r(I,2),Q=t(T),z=t(Q),X=r(t(z),2),d=t(X,!0);a(X),a(z);var o=r(z,2);{var n=v=>{var w=Ra(),W=r(t(w),2),ut=t(W,!0);a(W),a(w),S(ct=>f(ut,ct),[()=>zt(e.data.batch.completed_date)]),g(v,w)};F(o,v=>{e.data.batch.completed_date&&v(n)})}var E=r(o,2);{var P=v=>{var w=Ca(),W=r(t(w),2),ut=t(W,!0);a(W),a(w),S(ct=>f(ut,ct),[()=>ua(e.data.batch.duration)]),g(v,w)};F(E,v=>{e.data.batch.duration!==null&&v(P)})}a(Q),a(T),a(D);var gt=r(D,2),xt=r(t(gt),2),$=t(xt),bt=t($);H(bt,{get status(){return _.COMPLETED}});var pt=r(bt,2),Vt=t(pt,!0);a(pt),a($);var tt=r($,2),yt=t(tt);H(yt,{get status(){return _.RUNNING}});var wt=r(yt,2),qt=t(wt,!0);a(wt),a(tt);var at=r(tt,2),ht=t(at);H(ht,{get status(){return _.PENDING}});var kt=r(ht,2),Jt=t(kt,!0);a(kt),a(at);var et=r(at,2),St=t(et);H(St,{get status(){return _.ERROR}});var Dt=r(St,2),Kt=t(Dt,!0);a(Dt),a(et);var Et=r(et,2),Nt=t(Et);H(Nt,{get status(){return _.FAILED}});var It=r(Nt,2),Qt=t(It,!0);a(It),a(Et),a(xt),a(gt),a(m);var rt=r(m,2),Xt=t(rt);Da(Xt,{get batchId(){return e.data.batchId},get workflowDefinitions(){return e.data.workflowDefinitions},get paramSets(){return e.data.paramSets},onSuccess:i}),a(rt);var Rt=r(rt,2),st=t(Rt),Ct=r(t(st),2),ot=r(t(Ct),2),dt=t(ot);dt.value=dt.__value="all";var lt=r(dt),Pt={},it=r(lt),Wt={},nt=r(it),Lt={},vt=r(nt),Ft={},Ot=r(vt),Gt={};a(ot),a(Ct),a(st);var Yt=r(st,2);la(Yt,{get workflows(){return l(b)}}),a(Rt),a(k),a(y),S(v=>{f(Y,`#${e.data.batch.id??""}`),f(A,e.data.batch.source),f(M,e.data.documentCount),f(d,v),f(Vt,e.data.workflowCounts.COMPLETED||0),f(qt,e.data.workflowCounts.RUNNING||0),f(Jt,e.data.workflowCounts.PENDING||0),f(Kt,e.data.workflowCounts.ERROR||0),f(Qt,e.data.workflowCounts.FAILED||0),Pt!==(Pt=_.PENDING)&&(lt.value=(lt.__value=_.PENDING)??""),Wt!==(Wt=_.RUNNING)&&(it.value=(it.__value=_.RUNNING)??""),Lt!==(Lt=_.COMPLETED)&&(nt.value=(nt.__value=_.COMPLETED)??""),Ft!==(Ft=_.ERROR)&&(vt.value=(vt.__value=_.ERROR)??""),Gt!==(Gt=_.FAILED)&&(Ot.value=(Ot.__value=_.FAILED)??"")},[()=>zt(e.data.batch.start_date)]),_t(ot,()=>l(u),v=>h(u,v)),g(s,y),Ht()}export{Ka as component,Ja as universal};
