import{a as H,P as Vt}from"../chunks/hTc4Iqh7.js";import{e as Ft,i as Xt}from"../chunks/rpC5PbGf.js";import{B as Yt,c as m,k as t,l as e,x as F,r as a,e as y,z as Zt,h as c,m as v,p as zt,C as Ot,I as $t,J as ct,g as d,K as ta,j as At,D as Gt,L as aa,n as Bt,s as L,a as g,d as ea,u as Tt}from"../chunks/DCSobnyE.js";import{W as ra}from"../chunks/SwHyXTjJ.js";import{S as U}from"../chunks/D5EJ8H-Q.js";import{R as u}from"../chunks/BOsosYgm.js";import{c as jt,a as sa}from"../chunks/B5MikgXH.js";var oa=m('<span class="text-sm text-gray-600"> </span>'),da=m('<div class="flex items-center justify-center gap-2"><div role="status" aria-label="Loading"></div> <!></div>');function ia(I,r){let n=Yt(r,"size",3,"md");const p={sm:"h-4 w-4 border-2",md:"h-8 w-8 border-3",lg:"h-12 w-12 border-4"};var x=da(),f=t(x),w=e(f,2);{var h=S=>{var b=oa(),k=t(b,!0);a(b),y(()=>v(k,r.text)),c(S,b)};F(w,S=>{r.text&&S(h)})}a(x),y(()=>Zt(f,1,`animate-spin rounded-full border-blue-600 border-t-transparent ${p[n()]??""}`)),c(I,x)}const la=async({params:I})=>{try{const r=parseInt(I.id);if(isNaN(r))throw Ft(400,"Invalid batch ID");const[n,p,x,f]=await Promise.all([H.getBatchStatus(r),H.getWorkflowRuns(r),H.getWorkflowDefinitions(),H.getParamSets()]);return{batchId:r,batch:n.batch,documentCount:n.document_count,workflowCounts:n.workflow_count,workflows:p,parsed:n.parsed,remaining:n.remaining,workflowDefinitions:x,paramSets:f}}catch(r){throw console.error("Failed to load batch:",r),Ft(404,"Batch not found")}},Ca=Object.freeze(Object.defineProperty({__proto__:null,load:la},Symbol.toStringTag,{value:"Module"}));var na=m("<option> </option>"),va=m("<option> </option>"),ua=m('<div class="rounded-md bg-red-50 p-3" role="alert"><p class="text-sm text-red-800"> </p></div>'),ca=m('<div class="rounded-md bg-green-50 p-3" role="alert"><p class="text-sm text-green-800"> </p></div>'),ma=m("<!> <span>Starting...</span>",1),fa=m("<span>Start Workflows</span>"),_a=m('<div class="rounded-lg border border-gray-200 bg-white p-6 shadow"><h3 class="text-lg font-semibold text-gray-900">Start Workflows</h3> <p class="mt-1 text-sm text-gray-600">Start workflow processing for all documents in this batch</p> <form class="mt-4 space-y-4"><div><label for="workflow" class="block text-sm font-medium text-gray-700">Workflow Definition</label> <select id="workflow" class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"><option>Default (from config)</option><!></select></div> <div><label for="param-set" class="block text-sm font-medium text-gray-700">Parameter Set</label> <select id="param-set" class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"><option>Default</option><!></select></div> <div><label for="priority" class="block text-sm font-medium text-gray-700">Priority</label> <input type="number" id="priority" min="0" max="100" class="mt-1 block w-full rounded-md border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"/> <p class="mt-1 text-xs text-gray-500">Higher values = higher priority (default: 0)</p></div> <!> <!> <div class="flex justify-end"><button type="submit" class="inline-flex items-center gap-2 rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-400 disabled:cursor-not-allowed"><!></button></div></form></div>');function ga(I,r){zt(r,!0);let n=L(""),p=L("default"),x=L(0),f=L(!1),w=L(null),h=L(null);async function S(o){o.preventDefault(),g(f,!0),g(w,null),g(h,null);try{const s=await H.startWorkflows(r.batchId,d(n)||void 0,d(x),d(p)||void 0);g(h,`${s.message}: ${s.workflows} workflows started (Run Group: ${s.run_group})`),g(n,""),g(p,"default"),g(x,0),r.onSuccess&&setTimeout(r.onSuccess,1500)}catch(s){g(w,s instanceof Error?s.message:"Failed to start workflows",!0)}finally{g(f,!1)}}var b=_a(),k=e(t(b),4),N=t(k),E=e(t(N),2),O=t(E);O.value=O.__value="";var X=e(O);Ot(X,17,()=>r.workflowDefinitions,Gt,(o,s)=>{var i=na(),D=t(i);a(i);var P={};y(()=>{v(D,`${d(s).name??""} (${d(s).id??""})`),P!==(P=d(s).id)&&(i.value=(i.__value=d(s).id)??"")}),c(o,i)}),a(E),a(N);var R=e(N,2),C=e(t(R),2),T=t(C);T.value=T.__value="";var j=e(T);Ot(j,17,()=>r.paramSets,Gt,(o,s)=>{var i=va(),D=t(i);a(i);var P={};y(()=>{v(D,`${d(s).name??""} (${d(s).id??""})`),P!==(P=d(s).id)&&(i.value=(i.__value=d(s).id)??"")}),c(o,i)}),a(C),a(R);var G=e(R,2),z=e(t(G),2);aa(z),Bt(2),a(G);var A=e(G,2);{var J=o=>{var s=ua(),i=t(s),D=t(i,!0);a(i),a(s),y(()=>v(D,d(w))),c(o,s)};F(A,o=>{d(w)&&o(J)})}var K=e(A,2);{var Y=o=>{var s=ca(),i=t(s),D=t(i,!0);a(i),a(s),y(()=>v(D,d(h))),c(o,s)};F(K,o=>{d(h)&&o(Y)})}var q=e(K,2),B=t(q),Q=t(B);{var M=o=>{var s=ma(),i=ea(s);ia(i,{size:"sm"}),Bt(2),c(o,s)},V=o=>{var s=fa();c(o,s)};F(Q,o=>{d(f)?o(M):o(V,!1)})}a(B),a(q),a(k),a(b),y(()=>{E.disabled=d(f),C.disabled=d(f),z.disabled=d(f),B.disabled=d(f)}),$t("submit",k,S),ct(E,()=>d(n),o=>g(n,o)),ct(C,()=>d(p),o=>g(p,o)),ta(z,()=>d(x),o=>g(x,o)),c(I,b),At()}var xa=m('<a href="/batches" class="text-sm font-medium text-gray-600 hover:text-gray-900">← Back to batches</a>'),ba=m('<span class="inline-flex items-center rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800">✓ Complete</span>'),pa=m('<span class="inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-sm font-medium text-blue-800">⟳ In Progress</span>'),wa=m('<div><dt class="text-sm font-medium text-gray-500">Completed</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div>'),ya=m('<div><dt class="text-sm font-medium text-gray-500">Duration</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div>'),ha=m('<div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8"><!> <div class="mt-6"><div class="overflow-hidden rounded-lg bg-white shadow"><div class="px-6 py-5"><div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"><div><dt class="text-sm font-medium text-gray-500">Batch ID</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Source</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Documents</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Status</dt> <dd class="mt-1"><!></dd></div></div> <div class="mt-6 border-t border-gray-200 pt-6"><div class="grid grid-cols-1 gap-6 sm:grid-cols-2"><div><dt class="text-sm font-medium text-gray-500">Started</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <!> <!></div></div></div> <div class="border-t border-gray-200 bg-gray-50 px-6 py-4"><h3 class="text-sm font-medium text-gray-700">Workflow Status</h3> <div class="mt-3 flex flex-wrap gap-4"><div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div></div></div></div> <div class="mt-8"><!></div> <div class="mt-8"><div class="mb-4 flex items-center justify-between"><h2 class="text-lg font-semibold text-gray-900">Workflows</h2> <div class="flex items-center gap-2"><label for="status-select" class="text-sm text-gray-600">Filter:</label> <select id="status-select" class="rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"><option>All</option><option>Pending</option><option>Running</option><option>Completed</option><option>Error</option><option>Failed</option></select></div></div> <!></div></div></div>');function Pa(I,r){zt(r,!0);let n=L("all");const p=Tt(()=>d(n)==="all"?r.data.workflows:r.data.workflows.filter(l=>l.status===d(n))),x=Tt(()=>r.data.batch.completed_date!==null);function f(){Xt()}var w=ha(),h=t(w);Vt(h,{get title(){return`Batch: ${r.data.batch.name??""}`},actions:_=>{var W=xa();c(_,W)}});var S=e(h,2),b=t(S),k=t(b),N=t(k),E=t(N),O=e(t(E),2),X=t(O);a(O),a(E);var R=e(E,2),C=e(t(R),2),T=t(C,!0);a(C),a(R);var j=e(R,2),G=e(t(j),2),z=t(G,!0);a(G),a(j);var A=e(j,2),J=e(t(A),2),K=t(J);{var Y=l=>{var _=ba();c(l,_)},q=l=>{var _=pa();c(l,_)};F(K,l=>{d(x)?l(Y):l(q,!1)})}a(J),a(A),a(N);var B=e(N,2),Q=t(B),M=t(Q),V=e(t(M),2),o=t(V,!0);a(V),a(M);var s=e(M,2);{var i=l=>{var _=wa(),W=e(t(_),2),vt=t(W,!0);a(W),a(_),y(ut=>v(vt,ut),[()=>jt(r.data.batch.completed_date)]),c(l,_)};F(s,l=>{r.data.batch.completed_date&&l(i)})}var D=e(s,2);{var P=l=>{var _=ya(),W=e(t(_),2),vt=t(W,!0);a(W),a(_),y(ut=>v(vt,ut),[()=>sa(r.data.batch.duration)]),c(l,_)};F(D,l=>{r.data.batch.duration!==null&&l(P)})}a(Q),a(B),a(k);var mt=e(k,2),ft=e(t(mt),2),Z=t(ft),_t=t(Z);U(_t,{get status(){return u.COMPLETED}});var gt=e(_t,2),Mt=t(gt,!0);a(gt),a(Z);var $=e(Z,2),xt=t($);U(xt,{get status(){return u.RUNNING}});var bt=e(xt,2),Ut=t(bt,!0);a(bt),a($);var tt=e($,2),pt=t(tt);U(pt,{get status(){return u.PENDING}});var wt=e(pt,2),Ht=t(wt,!0);a(wt),a(tt);var at=e(tt,2),yt=t(at);U(yt,{get status(){return u.ERROR}});var ht=e(yt,2),Jt=t(ht,!0);a(ht),a(at);var kt=e(at,2),Dt=t(kt);U(Dt,{get status(){return u.FAILED}});var St=e(Dt,2),Kt=t(St,!0);a(St),a(kt),a(ft),a(mt),a(b);var et=e(b,2),qt=t(et);ga(qt,{get batchId(){return r.data.batchId},get workflowDefinitions(){return r.data.workflowDefinitions},get paramSets(){return r.data.paramSets},onSuccess:f}),a(et);var Et=e(et,2),rt=t(Et),It=e(t(rt),2),st=e(t(It),2),ot=t(st);ot.value=ot.__value="all";var dt=e(ot),Nt={},it=e(dt),Rt={},lt=e(it),Ct={},nt=e(lt),Pt={},Wt=e(nt),Lt={};a(st),a(It),a(rt);var Qt=e(rt,2);ra(Qt,{get workflows(){return d(p)}}),a(Et),a(S),a(w),y(l=>{v(X,`#${r.data.batch.id??""}`),v(T,r.data.batch.source),v(z,r.data.documentCount),v(o,l),v(Mt,r.data.workflowCounts.COMPLETED||0),v(Ut,r.data.workflowCounts.RUNNING||0),v(Ht,r.data.workflowCounts.PENDING||0),v(Jt,r.data.workflowCounts.ERROR||0),v(Kt,r.data.workflowCounts.FAILED||0),Nt!==(Nt=u.PENDING)&&(dt.value=(dt.__value=u.PENDING)??""),Rt!==(Rt=u.RUNNING)&&(it.value=(it.__value=u.RUNNING)??""),Ct!==(Ct=u.COMPLETED)&&(lt.value=(lt.__value=u.COMPLETED)??""),Pt!==(Pt=u.ERROR)&&(nt.value=(nt.__value=u.ERROR)??""),Lt!==(Lt=u.FAILED)&&(Wt.value=(Wt.__value=u.FAILED)??"")},[()=>jt(r.data.batch.start_date)]),ct(st,()=>d(n),l=>g(n,l)),c(I,w),At()}export{Pa as component,Ca as universal};
