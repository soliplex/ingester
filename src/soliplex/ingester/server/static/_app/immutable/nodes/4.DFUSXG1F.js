import{a as K,P as Xt}from"../chunks/zI6Ey5o2.js";import{e as Ot}from"../chunks/CBbuBPfZ.js";import{f as _,e as Yt,a as f,s as m}from"../chunks/DRP4mRRp.js";import{p as Mt,c as t,t as C,g as o,a as Ut,s as e,r as a,n as mt,as as h,y as u,f as Zt,u as Ft}from"../chunks/pasavVN_.js";import{i as A}from"../chunks/B7f9mVOY.js";import{b as ft}from"../chunks/Cve0h9Fw.js";import{W as $t}from"../chunks/jxvT9yMg.js";import{S as J}from"../chunks/CnkkU-xV.js";import{e as Gt,i as Tt,r as At}from"../chunks/CCxkpujE.js";import{b as ta,a as aa,L as ea}from"../chunks/BucLHc3f.js";import{T as Bt}from"../chunks/DQJyJeco.js";import{R as v}from"../chunks/BOsosYgm.js";import{c as ra}from"../chunks/Or1p4CJ_.js";import{i as sa}from"../chunks/L8TLXicd.js";const oa=async({params:B})=>{try{const r=parseInt(B.id);if(isNaN(r))throw Ot(400,"Invalid batch ID");const[n,b,y,w]=await Promise.all([K.getBatchStatus(r),K.getWorkflowRuns(r),K.getWorkflowDefinitions(),K.getParamSets()]);return{batchId:r,batch:n.batch,documentCount:n.document_count,workflowCounts:n.workflow_count,workflows:b,parsed:n.parsed,remaining:n.remaining,workflowDefinitions:y,paramSets:w}}catch(r){throw console.error("Failed to load batch:",r),Ot(404,"Batch not found")}},Oa=Object.freeze(Object.defineProperty({__proto__:null,load:oa},Symbol.toStringTag,{value:"Module"}));var da=_("<option> </option>"),ia=_("<option> </option>"),la=_('<div class="rounded-md bg-red-50 p-3" role="alert"><p class="text-sm text-red-800"> </p></div>'),na=_('<div class="rounded-md bg-green-50 p-3" role="alert"><p class="text-sm text-green-800"> </p></div>'),va=_("<!> <span>Starting...</span>",1),ua=_("<span>Start Workflows</span>"),ca=_('<div class="rounded-lg border border-gray-200 bg-white p-6 shadow"><h3 class="text-lg font-semibold text-gray-900">Start Workflows</h3> <p class="mt-1 text-sm text-gray-600">Start workflow processing for all documents in this batch</p> <form class="mt-4 space-y-4"><div><label for="workflow" class="block text-sm font-medium text-gray-700">Workflow Definition</label> <select id="workflow" class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"><option>Default</option><!></select></div> <div><label for="param-set" class="block text-sm font-medium text-gray-700">Parameter Set</label> <select id="param-set" class="mt-1 block w-full rounded-md border-gray-300 py-2 pl-3 pr-10 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"><option>Default</option><!></select></div> <div><label for="priority" class="block text-sm font-medium text-gray-700">Priority</label> <input type="number" id="priority" min="0" max="100" class="mt-1 block w-full rounded-md border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500 disabled:bg-gray-100 disabled:text-gray-500"/> <p class="mt-1 text-xs text-gray-500">Higher values = higher priority (default: 0)</p></div> <div class="flex items-center gap-2"><input type="checkbox" id="only-unparsed" class="h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"/> <label for="only-unparsed" class="text-sm font-medium text-gray-700">Only unparsed documents</label></div> <p class="mt-1 text-xs text-gray-500">Skip documents that already have a completed workflow run</p> <!> <!> <div class="flex justify-end"><button type="submit" class="inline-flex items-center gap-2 rounded-md bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:bg-gray-400 disabled:cursor-not-allowed"><!></button></div></form></div>');function ma(B,r){Mt(r,!0);let n=h(""),b=h("default"),y=h(0),w=h(!1),g=h(!1),k=h(null),S=h(null);async function M(d){d.preventDefault(),u(g,!0),u(k,null),u(S,null);try{const s=await K.startWorkflows(r.batchId,o(n)||void 0,o(y),o(b)||void 0,o(w));u(S,`${s.message}: ${s.workflows} workflows started (Run Group: ${s.run_group})`),u(n,""),u(b,"default"),u(y,0),u(w,!1),r.onSuccess&&setTimeout(r.onSuccess,1500)}catch(s){u(k,s instanceof Error?s.message:"Failed to start workflows",!0)}finally{u(g,!1)}}var D=ca(),E=e(t(D),4),N=t(E),I=e(t(N),2),U=t(I);U.value=U.__value="";var j=e(U);Gt(j,17,()=>r.workflowDefinitions,Tt,(d,s)=>{var i=da(),p=t(i);a(i);var x={};C(()=>{m(p,`${o(s).name??""} (${o(s).id??""})`),x!==(x=o(s).id)&&(i.value=(i.__value=o(s).id)??"")}),f(d,i)}),a(I),a(N);var W=e(N,2),L=e(t(W),2),R=t(L);R.value=R.__value="";var Q=e(R);Gt(Q,17,()=>r.paramSets,Tt,(d,s)=>{var i=ia(),p=t(i);a(i);var x={};C(()=>{m(p,`${o(s).name??""} (${o(s).id??""})`),x!==(x=o(s).id)&&(i.value=(i.__value=o(s).id)??"")}),f(d,i)}),a(L),a(W);var z=e(W,2),O=e(t(z),2);At(O),mt(2),a(z);var F=e(z,2),H=t(F);At(H),mt(2),a(F);var V=e(F,4);{var Z=d=>{var s=la(),i=t(s),p=t(i,!0);a(i),a(s),C(()=>m(p,o(k))),f(d,s)};A(V,d=>{o(k)&&d(Z)})}var q=e(V,2);{var X=d=>{var s=na(),i=t(s),p=t(i,!0);a(i),a(s),C(()=>m(p,o(S))),f(d,s)};A(q,d=>{o(S)&&d(X)})}var G=e(q,2),T=t(G),$=t(T);{var Y=d=>{var s=va(),i=Zt(s);ea(i,{size:"sm"}),mt(2),f(d,s)},tt=d=>{var s=ua();f(d,s)};A($,d=>{o(g)?d(Y):d(tt,!1)})}a(T),a(G),a(E),a(D),C(()=>{I.disabled=o(g),L.disabled=o(g),O.disabled=o(g),H.disabled=o(g),T.disabled=o(g)}),Yt("submit",E,M),ft(I,()=>o(n),d=>u(n,d)),ft(L,()=>o(b),d=>u(b,d)),ta(O,()=>o(y),d=>u(y,d)),aa(H,()=>o(w),d=>u(w,d)),f(B,D),Ut()}var fa=_('<a href="/batches" class="text-sm font-medium text-gray-600 hover:text-gray-900">← Back to batches</a>'),_a=_('<span class="inline-flex items-center rounded-full bg-green-100 px-3 py-1 text-sm font-medium text-green-800">✓ Complete</span>'),ga=_('<span class="inline-flex items-center rounded-full bg-blue-100 px-3 py-1 text-sm font-medium text-blue-800">⟳ In Progress</span>'),pa=_('<div><dt class="text-sm font-medium text-gray-500">Completed</dt> <dd class="mt-1 text-sm"><!></dd></div>'),xa=_('<div><dt class="text-sm font-medium text-gray-500">Duration</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div>'),ba=_('<div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8"><!> <div class="mt-6"><div class="overflow-hidden rounded-lg bg-white shadow"><div class="px-6 py-5"><div class="grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"><div><dt class="text-sm font-medium text-gray-500">Batch ID</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Source</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Documents</dt> <dd class="mt-1 text-lg font-semibold text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Status</dt> <dd class="mt-1"><!></dd></div></div> <div class="mt-6 border-t border-gray-200 pt-6"><div class="grid grid-cols-1 gap-6 sm:grid-cols-2"><div><dt class="text-sm font-medium text-gray-500">Started</dt> <dd class="mt-1 text-sm"><!></dd></div> <!> <!></div></div></div> <div class="border-t border-gray-200 bg-gray-50 px-6 py-4"><h3 class="text-sm font-medium text-gray-700">Workflow Status</h3> <div class="mt-3 flex flex-wrap gap-4"><div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div> <div class="flex items-center gap-2"><!> <span class="text-sm text-gray-600"> </span></div></div></div></div> <div class="mt-8"><!></div> <div class="mt-8"><div class="mb-4 flex items-center justify-between"><h2 class="text-lg font-semibold text-gray-900">Workflows</h2> <div class="flex items-center gap-2"><label for="status-select" class="text-sm text-gray-600">Filter:</label> <select id="status-select" class="rounded-md border-gray-300 text-sm focus:border-blue-500 focus:ring-blue-500"><option>All</option><option>Pending</option><option>Running</option><option>Completed</option><option>Error</option><option>Failed</option></select></div></div> <!></div></div></div>');function Fa(B,r){Mt(r,!0);let n=h("all");const b=Ft(()=>o(n)==="all"?r.data.workflows:r.data.workflows.filter(l=>l.status===o(n))),y=Ft(()=>r.data.batch.completed_date!==null);function w(){sa()}var g=ba(),k=t(g);Xt(k,{get title(){return`Batch: ${r.data.batch.name??""}`},actions:c=>{var P=fa();f(c,P)}});var S=e(k,2),M=t(S),D=t(M),E=t(D),N=t(E),I=e(t(N),2),U=t(I);a(I),a(N);var j=e(N,2),W=e(t(j),2),L=t(W,!0);a(W),a(j);var R=e(j,2),Q=e(t(R),2),z=t(Q,!0);a(Q),a(R);var O=e(R,2),F=e(t(O),2),H=t(F);{var V=l=>{var c=_a();f(l,c)},Z=l=>{var c=ga();f(l,c)};A(H,l=>{o(y)?l(V):l(Z,!1)})}a(F),a(O),a(E);var q=e(E,2),X=t(q),G=t(X),T=e(t(G),2),$=t(T);Bt($,{get date(){return r.data.batch.start_date}}),a(T),a(G);var Y=e(G,2);{var tt=l=>{var c=pa(),P=e(t(c),2),ct=t(P);Bt(ct,{get date(){return r.data.batch.completed_date}}),a(P),a(c),f(l,c)};A(Y,l=>{r.data.batch.completed_date&&l(tt)})}var d=e(Y,2);{var s=l=>{var c=xa(),P=e(t(c),2),ct=t(P,!0);a(P),a(c),C(Vt=>m(ct,Vt),[()=>ra(r.data.batch.duration)]),f(l,c)};A(d,l=>{r.data.batch.duration!==null&&l(s)})}a(X),a(q),a(D);var i=e(D,2),p=e(t(i),2),x=t(p),_t=t(x);J(_t,{get status(){return v.COMPLETED}});var gt=e(_t,2),jt=t(gt,!0);a(gt),a(x);var at=e(x,2),pt=t(at);J(pt,{get status(){return v.RUNNING}});var xt=e(pt,2),zt=t(xt,!0);a(xt),a(at);var et=e(at,2),bt=t(et);J(bt,{get status(){return v.PENDING}});var yt=e(bt,2),Ht=t(yt,!0);a(yt),a(et);var rt=e(et,2),wt=t(rt);J(wt,{get status(){return v.ERROR}});var ht=e(wt,2),qt=t(ht,!0);a(ht),a(rt);var kt=e(rt,2),St=t(kt);J(St,{get status(){return v.FAILED}});var Dt=e(St,2),Jt=t(Dt,!0);a(Dt),a(kt),a(p),a(i),a(M);var st=e(M,2),Kt=t(st);ma(Kt,{get batchId(){return r.data.batchId},get workflowDefinitions(){return r.data.workflowDefinitions},get paramSets(){return r.data.paramSets},onSuccess:w}),a(st);var Et=e(st,2),ot=t(Et),Nt=e(t(ot),2),dt=e(t(Nt),2),it=t(dt);it.value=it.__value="all";var lt=e(it),It={},nt=e(lt),Rt={},vt=e(nt),Pt={},ut=e(vt),Ct={},Wt=e(ut),Lt={};a(dt),a(Nt),a(ot);var Qt=e(ot,2);$t(Qt,{get workflows(){return o(b)}}),a(Et),a(S),a(g),C(()=>{m(U,`#${r.data.batch.id??""}`),m(L,r.data.batch.source),m(z,r.data.documentCount),m(jt,r.data.workflowCounts.COMPLETED||0),m(zt,r.data.workflowCounts.RUNNING||0),m(Ht,r.data.workflowCounts.PENDING||0),m(qt,r.data.workflowCounts.ERROR||0),m(Jt,r.data.workflowCounts.FAILED||0),It!==(It=v.PENDING)&&(lt.value=(lt.__value=v.PENDING)??""),Rt!==(Rt=v.RUNNING)&&(nt.value=(nt.__value=v.RUNNING)??""),Pt!==(Pt=v.COMPLETED)&&(vt.value=(vt.__value=v.COMPLETED)??""),Ct!==(Ct=v.ERROR)&&(ut.value=(ut.__value=v.ERROR)??""),Lt!==(Lt=v.FAILED)&&(Wt.value=(Wt.__value=v.FAILED)??"")}),ft(dt,()=>o(n),l=>u(n,l)),f(B,g),Ut()}export{Fa as component,Oa as universal};
