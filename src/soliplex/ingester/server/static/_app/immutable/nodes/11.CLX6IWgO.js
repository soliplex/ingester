import{a as Mt,P as Ut}from"../chunks/hTc4Iqh7.js";import{e as Ot}from"../chunks/CKbI6y60.js";import{v as At,p as Pt,s as Ft,O as Gt,c,C as Ht,k as a,g as d,r as t,l as e,x as y,e as w,z as Tt,m as s,h as _,P as It,u as q,j as Nt,a as jt,y as Bt,d as Wt,q as Ct}from"../chunks/DCSobnyE.js";import{S as Lt}from"../chunks/D5EJ8H-Q.js";import{R as T,L as f}from"../chunks/BOsosYgm.js";import{a as Dt,c as K,t as Jt}from"../chunks/B5MikgXH.js";const zt=async({params:rt})=>{try{const i=parseInt(rt.id);if(isNaN(i))throw Ot(400,"Invalid workflow ID");const[x,st]=await Promise.all([Mt.getWorkflowRunDetails(i),Mt.getWorkflowLifecycleHistory(i)]);return{workflow:x,lifecycleHistory:st}}catch(i){throw console.error("Failed to load workflow:",i),Ot(404,"Workflow not found")}},ba=Object.freeze(Object.defineProperty({__proto__:null,load:zt},Symbol.toStringTag,{value:"Module"}));var qt=c('<div><dt class="font-medium text-gray-700">Worker</dt> <dd class="mt-1 text-gray-900"> </dd></div>'),Kt=c('<div class="mt-3"><dt class="font-medium text-gray-700">Status Message</dt> <dd class="mt-1 text-gray-900"> </dd></div>'),Qt=c('<div class="mt-3"><dt class="font-medium text-gray-700">Metadata</dt> <dd class="mt-1"><pre class="overflow-x-auto rounded bg-gray-100 p-2 text-xs text-gray-900"> </pre></dd></div>'),Vt=c('<div class="border-t border-gray-200 bg-gray-50 px-4 py-3"><dl class="grid grid-cols-1 gap-3 text-sm sm:grid-cols-2"><div><dt class="font-medium text-gray-700">Status</dt> <dd class="mt-1 text-gray-900"> </dd></div> <div><dt class="font-medium text-gray-700">Started</dt> <dd class="mt-1 text-gray-900"> </dd></div> <div><dt class="font-medium text-gray-700">Completed</dt> <dd class="mt-1 text-gray-900"> </dd></div> <div><dt class="font-medium text-gray-700">Duration</dt> <dd class="mt-1 text-gray-900"> </dd></div> <div><dt class="font-medium text-gray-700">Retries</dt> <dd class="mt-1 text-gray-900"> </dd></div> <!></dl> <!> <!></div>'),Xt=c('<div class="rounded-lg border border-gray-200 bg-white"><button type="button" class="w-full px-4 py-3 text-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"><div class="flex items-center gap-3"><span aria-hidden="true"> </span> <div class="flex-1"><div class="flex items-center gap-2"><span class="font-medium text-gray-900"> </span> <!></div> <div class="mt-1 text-xs text-gray-500"> <!></div></div> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div></button> <!></div>'),Yt=c('<div class="space-y-2"></div>');function Zt(rt,i){Pt(i,!0);let x=Ft(Gt(new Set));function st(g){d(x).has(g)?d(x).delete(g):d(x).add(g),jt(x,new Set(d(x)),!0)}function yt(g){switch(g){case T.COMPLETED:return"✓";case T.RUNNING:return"⟳";case T.PENDING:return"⏸";case T.ERROR:return"⚠";case T.FAILED:return"✗";default:return"•"}}function wt(g){switch(g){case T.COMPLETED:return"text-green-600";case T.RUNNING:return"text-blue-600 animate-pulse";case T.PENDING:return"text-gray-400";case T.ERROR:return"text-orange-600";case T.FAILED:return"text-red-600";default:return"text-gray-500"}}const it=q(()=>[...i.steps].sort((g,o)=>g.workflow_step_number-o.workflow_step_number));var Q=Yt();Ht(Q,21,()=>d(it),g=>g.id,(g,o)=>{var B=Xt(),v=a(B);v.__click=()=>st(d(o).id);var r=a(v),D=a(r),A=a(D,!0);t(D);var V=e(D,2),W=a(V),X=a(W),Y=a(X);t(X);var vt=e(X,2);Lt(vt,{get status(){return d(o).status},compact:!0}),t(W);var J=e(W,2),z=a(J),ct=e(z);{var ot=R=>{var F=It();w(N=>s(F,`• Duration: ${N??""}`),[()=>Dt(d(o).duration)]),_(R,F)};y(ct,R=>{d(o).duration!==null&&R(ot)})}t(J),t(V);var ht=e(V,2);t(r),t(v);var Z=e(v,2);{var lt=R=>{var F=Vt(),N=a(F),$=a(N),xt=e(a($),2),h=a(xt,!0);t(xt),t($);var k=e($,2),L=e(a(k),2),M=a(L,!0);t(L),t(k);var O=e(k,2),G=e(a(O),2),H=a(G,!0);t(G),t(O);var j=e(O,2),gt=e(a(j),2),tt=a(gt,!0);t(gt),t(j);var at=e(j,2),et=e(a(at),2),dt=a(et);t(et),t(at);var ft=e(at,2);{var nt=p=>{var E=qt(),I=e(a(E),2),U=a(I,!0);t(I),t(E),w(()=>s(U,d(o).worker_id)),_(p,E)};y(ft,p=>{d(o).worker_id&&p(nt)})}t(N);var _t=e(N,2);{var pt=p=>{var E=Kt(),I=e(a(E),2),U=a(I,!0);t(I),t(E),w(()=>s(U,d(o).status_message)),_(p,E)};y(_t,p=>{d(o).status_message&&p(pt)})}var ut=e(_t,2);{var bt=p=>{var E=Qt(),I=e(a(E),2),U=a(I),kt=a(U,!0);t(U),t(I),t(E),w(Et=>s(kt,Et),[()=>JSON.stringify(d(o).status_meta,null,2)]),_(p,E)};y(ut,p=>{Object.keys(d(o).status_meta).length>0&&p(bt)})}t(F),w((p,E,I)=>{s(h,d(o).status),s(M,p),s(H,E),s(tt,I),s(dt,`${d(o).retry??""}/${d(o).retries??""}`)},[()=>K(d(o).start_date),()=>K(d(o).completed_date),()=>Dt(d(o).duration)]),_(R,F)};y(Z,R=>{d(x).has(d(o).id)&&R(lt)})}t(B),w((R,F,N)=>{Tt(D,1,`text-lg ${R??""}`),s(A,F),s(Y,`${d(o).workflow_step_number??""}. ${d(o).workflow_step_name??""}`),s(z,`Type: ${d(o).step_type??""} `),Tt(ht,0,`h-5 w-5 text-gray-400 transition-transform ${N??""}`)},[()=>wt(d(o).status),()=>yt(d(o).status),()=>d(x).has(d(o).id)?"rotate-180":""]),_(g,B)}),t(Q),_(rt,Q),Nt()}At(["click"]);var $t=c('<div><dt class="font-medium text-gray-700">Handler Name</dt> <dd class="mt-1 text-gray-900"> </dd></div>'),ta=c('<div><dt class="font-medium text-gray-700">Step ID</dt> <dd class="mt-1 text-gray-900"> </dd></div>'),aa=c('<div><dt class="font-medium text-gray-700">Status Updated</dt> <dd class="mt-1 text-gray-900"> </dd></div>'),ea=c('<div><dt class="font-medium text-gray-700">Duration</dt> <dd class="mt-1 text-gray-900"> </dd></div>'),da=c('<div class="mt-3"><dt class="font-medium text-gray-700">Status Message</dt> <dd class="mt-1 text-gray-900"> </dd></div>'),ra=c('<div class="mt-3"><dt class="font-medium text-gray-700">Metadata</dt> <dd class="mt-1"><pre class="overflow-x-auto rounded bg-gray-100 p-2 text-xs text-gray-900"> </pre></dd></div>'),sa=c('<div class="border-t border-gray-200 bg-gray-50 px-4 py-3"><dl class="grid grid-cols-1 gap-3 text-sm sm:grid-cols-2"><div><dt class="font-medium text-gray-700">Event Type</dt> <dd class="mt-1 text-gray-900"> </dd></div> <div><dt class="font-medium text-gray-700">Status</dt> <dd class="mt-1 text-gray-900"> </dd></div> <!> <div><dt class="font-medium text-gray-700">Started</dt> <dd class="mt-1 text-gray-900"> </dd></div> <div><dt class="font-medium text-gray-700">Completed</dt> <dd class="mt-1 text-gray-900"> </dd></div> <!> <div><dt class="font-medium text-gray-700">Run Group ID</dt> <dd class="mt-1 text-gray-900"> </dd></div> <!> <!></dl> <!> <!></div>'),ia=c('<div><button type="button" class="w-full px-4 py-3 text-left hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500"><div class="flex items-center gap-3"><span aria-hidden="true"> </span> <div class="flex-1"><div class="flex items-center gap-2"><span class="font-medium text-gray-900"> <!></span> <!></div> <div class="mt-1 text-xs text-gray-500"> <!></div></div> <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></div></button> <!></div>'),va=c('<div class="space-y-2"></div>');function oa(rt,i){Pt(i,!0);let x=Ft(Gt(new Set));function st(v){d(x).has(v)?d(x).delete(v):d(x).add(v),jt(x,new Set(d(x)),!0)}function yt(v){return{[f.GROUP_START]:"Run Group Started",[f.GROUP_END]:"Run Group Completed",[f.ITEM_START]:"Item Processing Started",[f.ITEM_END]:"Item Processing Completed",[f.ITEM_FAILED]:"Item Processing Failed",[f.STEP_START]:"Step Started",[f.STEP_END]:"Step Completed",[f.STEP_FAILED]:"Step Failed"}[v]||v}function wt(v){switch(v){case f.GROUP_START:case f.ITEM_START:case f.STEP_START:return"▶";case f.GROUP_END:case f.ITEM_END:case f.STEP_END:return"✓";case f.ITEM_FAILED:case f.STEP_FAILED:return"✗";default:return"•"}}function it(v,r){return v===f.ITEM_FAILED||v===f.STEP_FAILED||r===T.FAILED||r===T.ERROR?"text-red-600":r===T.COMPLETED?"text-green-600":r===T.RUNNING?"text-blue-600":"text-gray-600"}function Q(v,r){return v===f.ITEM_FAILED||v===f.STEP_FAILED||r===T.FAILED||r===T.ERROR?"border-red-300":r===T.COMPLETED?"border-green-300":r===T.RUNNING?"border-blue-300":"border-gray-300"}function g(v){if(!v.start_date||!v.completed_date)return null;const r=new Date(v.start_date).getTime();return(new Date(v.completed_date).getTime()-r)/1e3}const o=q(()=>[...i.history].sort((v,r)=>{const D=new Date(v.start_date).getTime(),A=new Date(r.start_date).getTime();return D-A}));var B=va();Ht(B,21,()=>d(o),v=>v.id,(v,r)=>{var D=ia(),A=a(D);A.__click=()=>st(d(r).id);var V=a(A),W=a(V),X=a(W);t(W);var Y=e(W,2),vt=a(Y),J=a(vt),z=a(J),ct=e(z);{var ot=h=>{var k=It();w(()=>s(k,`-
								${d(r).handler_name??""}`)),_(h,k)};y(ct,h=>{d(r).handler_name&&h(ot)})}t(J);var ht=e(J,2);Lt(ht,{get status(){return d(r).status},compact:!0}),t(vt);var Z=e(vt,2),lt=a(Z),R=e(lt);{var F=h=>{const k=q(()=>g(d(r)));var L=Bt(),M=Wt(L);{var O=G=>{var H=It();w(j=>s(H,`• Duration: ${j??""}`),[()=>Dt(d(k))]),_(G,H)};y(M,G=>{d(k)!==null&&G(O)})}_(h,L)};y(R,h=>{d(r).completed_date&&h(F)})}t(Z),t(Y);var N=e(Y,2);t(V),t(A);var $=e(A,2);{var xt=h=>{var k=sa(),L=a(k),M=a(L),O=e(a(M),2),G=a(O,!0);t(O),t(M);var H=e(M,2),j=e(a(H),2),gt=a(j,!0);t(j),t(H);var tt=e(H,2);{var at=u=>{var m=$t(),S=e(a(m),2),C=a(S,!0);t(S),t(m),w(()=>s(C,d(r).handler_name)),_(u,m)};y(tt,u=>{d(r).handler_name&&u(at)})}var et=e(tt,2),dt=e(a(et),2),ft=a(dt,!0);t(dt),t(et);var nt=e(et,2),_t=e(a(nt),2),pt=a(_t,!0);t(_t),t(nt);var ut=e(nt,2);{var bt=u=>{var m=ta(),S=e(a(m),2),C=a(S,!0);t(S),t(m),w(()=>s(C,d(r).step_id)),_(u,m)};y(ut,u=>{d(r).step_id&&u(bt)})}var p=e(ut,2),E=e(a(p),2),I=a(E,!0);t(E),t(p);var U=e(p,2);{var kt=u=>{var m=aa(),S=e(a(m),2),C=a(S,!0);t(S),t(m),w(St=>s(C,St),[()=>K(d(r).status_date)]),_(u,m)};y(U,u=>{d(r).status_date&&u(kt)})}var Et=e(U,2);{var l=u=>{const m=q(()=>g(d(r)));var S=ea(),C=e(a(S),2),St=a(C,!0);t(C),t(S),w(Rt=>s(St,Rt),[()=>Dt(d(m))]),_(u,S)};y(Et,u=>{g(d(r))!==null&&u(l)})}t(L);var n=e(L,2);{var b=u=>{var m=da(),S=e(a(m),2),C=a(S,!0);t(S),t(m),w(()=>s(C,d(r).status_message)),_(u,m)};y(n,u=>{d(r).status_message&&u(b)})}var P=e(n,2);{var mt=u=>{var m=ra(),S=e(a(m),2),C=a(S),St=a(C,!0);t(C),t(S),t(m),w(Rt=>s(St,Rt),[()=>JSON.stringify(d(r).status_meta,null,2)]),_(u,m)};y(P,u=>{Object.keys(d(r).status_meta).length>0&&u(mt)})}t(k),w((u,m)=>{s(G,d(r).event),s(gt,d(r).status),s(ft,u),s(pt,m),s(I,d(r).run_group_id)},[()=>K(d(r).start_date),()=>K(d(r).completed_date)]),_(h,k)};y($,h=>{d(x).has(d(r).id)&&h(xt)})}t(D),w((h,k,L,M,O,G)=>{Tt(D,1,`rounded-lg border ${h??""} bg-white`),Tt(W,1,`text-lg ${k??""}`),s(X,`${L??""}-`),s(z,`${M??""} `),s(lt,`${O??""} `),Tt(N,0,`h-5 w-5 text-gray-400 transition-transform ${G??""}`)},[()=>Q(d(r).event,d(r).status),()=>it(d(r).event,d(r).status),()=>wt(d(r).event),()=>yt(d(r).event),()=>K(d(r).start_date),()=>d(x).has(d(r).id)?"rotate-180":""]),_(v,D)}),t(B),_(rt,B),Nt()}At(["click"]);var la=c('<a href="/workflows" class="text-sm font-medium text-gray-600 hover:text-gray-900">← Back to workflows</a>'),na=c('<div><dt class="text-sm font-medium text-gray-500">Progress</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div>'),_a=c('<div class="mt-6 rounded-md bg-gray-50 p-4"><h3 class="text-sm font-medium text-gray-700">Status Message</h3> <p class="mt-1 text-sm text-gray-900"> </p></div>'),ua=c('<div class="mt-6 rounded-md bg-gray-50 p-4"><h3 class="text-sm font-medium text-gray-700">Status Metadata</h3> <pre class="mt-2 overflow-x-auto text-xs text-gray-900"> </pre></div>'),ma=c('<div class="mt-8"><h2 class="mb-4 text-lg font-semibold text-gray-900">Workflow Steps</h2> <!></div>'),ca=c('<div class="mt-8"><h2 class="mb-4 text-lg font-semibold text-gray-900">Lifecycle History</h2> <div class="overflow-hidden rounded-lg bg-white shadow"><div class="px-6 py-5"><!></div></div></div>'),xa=c('<div class="mx-auto max-w-7xl px-4 py-6 sm:px-6 lg:px-8"><!> <div class="mt-6"><div class="overflow-hidden rounded-lg bg-white shadow"><div class="px-6 py-5"><div class="flex items-start justify-between"><div class="flex-1"><div class="flex items-center gap-3"><h2 class="text-xl font-semibold text-gray-900"> </h2> <!></div> <p class="mt-2 text-sm text-gray-600">Document: <span class="font-mono text-xs"> </span></p></div></div> <div class="mt-6 grid grid-cols-1 gap-6 border-t border-gray-200 pt-6 sm:grid-cols-2 lg:grid-cols-3"><div><dt class="text-sm font-medium text-gray-500">Definition</dt> <dd class="mt-1 text-sm text-gray-900"><a class="text-blue-600 hover:text-blue-700"> </a></dd></div> <div><dt class="text-sm font-medium text-gray-500">Batch</dt> <dd class="mt-1 text-sm text-gray-900"><a class="text-blue-600 hover:text-blue-700"> </a></dd></div> <div><dt class="text-sm font-medium text-gray-500">Run Group</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Priority</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Created</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Started</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Completed</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <div><dt class="text-sm font-medium text-gray-500">Duration</dt> <dd class="mt-1 text-sm text-gray-900"> </dd></div> <!></div> <!> <!></div></div> <!> <!></div></div>');function ka(rt,i){Pt(i,!0);const x=q(()=>i.data.workflow.steps&&i.data.workflow.steps.length>0),st=q(()=>{var l;return((l=i.data.workflow.steps)==null?void 0:l.filter(n=>n.status==="COMPLETED").length)||0}),yt=q(()=>{var l;return((l=i.data.workflow.steps)==null?void 0:l.length)||0}),wt=q(()=>i.data.lifecycleHistory&&i.data.lifecycleHistory.length>0);var it=xa(),Q=a(it);Ut(Q,{get title(){return`Workflow Run #${i.data.workflow.id??""}`},actions:n=>{var b=la();_(n,b)}});var g=e(Q,2),o=a(g),B=a(o),v=a(B),r=a(v),D=a(r),A=a(D),V=a(A);t(A);var W=e(A,2);Lt(W,{get status(){return i.data.workflow.status}}),t(D);var X=e(D,2),Y=e(a(X)),vt=a(Y,!0);t(Y),t(X),t(r),t(v);var J=e(v,2),z=a(J),ct=e(a(z),2),ot=a(ct),ht=a(ot,!0);t(ot),t(ct),t(z);var Z=e(z,2),lt=e(a(Z),2),R=a(lt),F=a(R);t(R),t(lt),t(Z);var N=e(Z,2),$=e(a(N),2),xt=a($);t($),t(N);var h=e(N,2),k=e(a(h),2),L=a(k,!0);t(k),t(h);var M=e(h,2),O=e(a(M),2),G=a(O,!0);t(O),t(M);var H=e(M,2),j=e(a(H),2),gt=a(j,!0);t(j),t(H);var tt=e(H,2),at=e(a(tt),2),et=a(at,!0);t(at),t(tt);var dt=e(tt,2),ft=e(a(dt),2),nt=a(ft,!0);t(ft),t(dt);var _t=e(dt,2);{var pt=l=>{var n=na(),b=e(a(n),2),P=a(b);t(b),t(n),w(()=>s(P,`${d(st)??""}/${d(yt)??""} steps`)),_(l,n)};y(_t,l=>{d(x)&&l(pt)})}t(J);var ut=e(J,2);{var bt=l=>{var n=_a(),b=e(a(n),2),P=a(b,!0);t(b),t(n),w(()=>s(P,i.data.workflow.status_message)),_(l,n)};y(ut,l=>{i.data.workflow.status_message&&l(bt)})}var p=e(ut,2);{var E=l=>{var n=ua(),b=e(a(n),2),P=a(b,!0);t(b),t(n),w(mt=>s(P,mt),[()=>JSON.stringify(i.data.workflow.status_meta,null,2)]),_(l,n)};y(p,l=>{Object.keys(i.data.workflow.status_meta).length>0&&l(E)})}t(B),t(o);var I=e(o,2);{var U=l=>{var n=ma(),b=e(a(n),2);{let P=q(()=>i.data.workflow.steps||[]);Zt(b,{get steps(){return d(P)}})}t(n),_(l,n)};y(I,l=>{d(x)&&l(U)})}var kt=e(I,2);{var Et=l=>{var n=ca(),b=e(a(n),2),P=a(b),mt=a(P);oa(mt,{get history(){return i.data.lifecycleHistory}}),t(P),t(b),t(n),_(l,n)};y(kt,l=>{d(wt)&&l(Et)})}t(g),t(it),w((l,n,b,P,mt)=>{s(V,`Workflow #${i.data.workflow.id??""}`),s(vt,l),Ct(ot,"href",`/definitions/workflows/${i.data.workflow.workflow_definition_id??""}`),s(ht,i.data.workflow.workflow_definition_id),Ct(R,"href",`/batches/${i.data.workflow.batch_id??""}`),s(F,`#${i.data.workflow.batch_id??""}`),s(xt,`#${i.data.workflow.run_group_id??""}`),s(L,i.data.workflow.priority),s(G,n),s(gt,b),s(et,P),s(nt,mt)},[()=>Jt(i.data.workflow.doc_id,60),()=>K(i.data.workflow.created_date),()=>K(i.data.workflow.start_date),()=>K(i.data.workflow.completed_date),()=>Dt(i.data.workflow.duration)]),_(rt,it),Nt()}export{ka as component,ba as universal};
